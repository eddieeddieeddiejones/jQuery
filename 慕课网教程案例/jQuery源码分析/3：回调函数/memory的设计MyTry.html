<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script src="http://img.mukewang.com/down/540812440001e40e00000000.js" type="text/javascript"></script>
<script src="http://img.mukewang.com/down/541f6ff70001a0a500000000.js" type="text/javascript"></script>
<title></title>
</head>
<body>

<script type="text/javascript">


function Callbacks(options) {
  var list = [];
  var self;
  var firingStart;
  var memory;

  function _fire(data) {//foo
    //options === 'memory'==> memory = data
    //options !== 'memory'==> memory = false
    memory = options === 'memory' && data;//foo
    firingIndex = firingStart || 0;
    // console.log(firingIndex)//0 1 0 2 0
    firingStart = 0;
    firingLength = list.length;
    for (; list && firingIndex < firingLength; firingIndex++) {
      list[firingIndex](data)
    }
  }

  self = {
    add: function(fn) {
      var start = list.length;
      // console.log(start)//0 1 2
      list.push(fn)
      // console.log(memory)//undefined foo bar
      if (memory) {
        firingStart = start; //获取最后一值
        // console.log(firingStart)//1 2 
        console.log(memory)//foo bar
        _fire(memory);
      }
    },
    fire: function(args) {
      if (list) {
        _fire(args)
      }
    }
  }
  return self;
}

function show(data) {
  if (!data) {
    return $("body").append('</br>')
  }
  if (typeof data === 'object') {
    for (var key in data) {
      $("body").append('<li>key->' + key + '; value->'+ data[key] +'</li>')
    }
  } else {
    $("body").append('<li>' + data + '</li>')
  }
}


function fn1(val) {
  show('fn1 says ' + val);
}

function fn2(val) {
  show('fn2 says ' + val);
}

function fn3(val) {
  show('fn3 says ' + val);
}

var cbs = Callbacks('memory');
cbs.add(fn1);
cbs.fire('foo');//fn1 says foo



cbs.add(fn2);//fn2 says foo
// fn1 says bar
// fn2 says bar
cbs.fire('bar');


//fn3 says bar
cbs.add(fn3);
// fn1 says aaron
// fn3 says aaron
// fn2 says aaron
cbs.fire('aaron')



</script>

</body>
</html>
