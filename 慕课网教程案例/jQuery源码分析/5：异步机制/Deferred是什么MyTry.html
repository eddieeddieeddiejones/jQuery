<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script src="http://img.mukewang.com/down/540812440001e40e00000000.js" type="text/javascript"></script>
<title></title>
</head>
<body>

<div id="aaron1">运行案例一</div>

<div id="aaron2">运行案例二</div>

<script type="text/javascript">


//提供一种方法来执行一个或多个对象的回调函数
//在实际开发中，我们可能要发送多个异步的请求操作，我们需要等所有的异步都处理完毕后，才能继续下一个动作

//案例一
// function task1(name,fn){
//   //这么写会立即执行
//   // setTimeout(fn(name),500)
//   setTimeout(function(){
//     fn(name)
//   },500)
// }
// function task2(name,fn){
//   setTimeout(function(){
//     fn(name)
//   },1000)
// }
// var taskNums = function(){
//   var num = 2
//   return function(){
//     show(num)
//     if(num === 1){
//       show("任务完成了")
//     }
//     num--
//   }
// }()

// $("#aaron1").click(function(){
//   task1("task1",function(name){
//     show(name)
//     taskNums()
//   })
//   task2("task2",function(name){
//     show(name)
//     taskNums()
//   })
// })
//结果
// task1
// 2
// task2
// 1
// 任务完成了

//========================分割线============================================


//结果
// task3执行完毕
// task4执行完毕
// when处理成功
//案例二
// 通过Deferred改进
function task3(name){
  var dtd = $.Deferred()
  setTimeout(function(){
    show("task3执行成功",$("#aaron2"))
    dtd.resolve(name)
  },500)
  return dtd
}

function task4(name){
  var dtd = $.Deferred()
  setTimeout(function(){
    show("task4执行成功",$("#aaron2"))
    dtd.resolve(name)
  },1000)
  return dtd
}

//为什么要这么写？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？
$("#aaron2").click(function(event) {
  $.when(task3("task3"),task4("task4")).done(function(){
    show("when处理成功",$("#aaron2"))
  })
})


function show(message,ele){
  (ele || $("body")).append("<li>"+ message+ "</li>")
}




</script>

</body>
</html>















