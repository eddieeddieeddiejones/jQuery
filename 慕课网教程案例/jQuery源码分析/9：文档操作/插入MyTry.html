<!doctype html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<!-- // <script src="http://img.mukewang.com/down/540812440001e40e00000000.js" type="text/javascript"></script> -->
	 <script type="text/javascript" src="../jquery-2.1.1.js"></script>
	<title>DOM插入</title>
</head>
<body>

<button id="test1">html取值操作</button>
<button id="test2">html设值操作</button>
<button id="test3">text取值操作</button>
<button id="test4">text设值操作</button>

<div class="container">
  <div class="inner">Hello</div>
  <div class="inner">Goodbye</div>
</div>

  <p>
  	<b>TestP1</b>Paragraph.
  </p>
  <p>TestP2</p>

<script type="text/javascript">
function html(value){
	// value为空，获取数组第一个元素的值
	// 有value，就给每个匹配到的元素赋值value
	var elem
	var i 
	if(value === undefined){
		elem = this[0] || {}
		if(elem.nodeType === 1){
			return elem.innerHTML
		}
	}
	for (i = 0; i < this.length; i++) {
		var node = this[i]
		node.innerHTML = value
	};
}

function text(value){
	if(value === undefined){
		return getText(this)
	} else {
		return setText.call(this,value)
	}

}

// console.log(undefined.length)


// var button = document.getElementById("test1")
// 控制台下调试环境下查看button.firstChild.nodeValue
function getText(elem){
	var node,
	ret,
	i=0,
	nodeType = elem.nodeType
	// 事先约定是数组或者元素
	// 如果是数组
	if(!nodeType){
		while(node = elem[i++]){
			ret+=getText(node)
		}
		//element document fragment
	}else if( elem.nodeType === 1 || elem.nodeType === 9 || elem.nodeType === 11){
		//如果支持textContent
		if(typeof elem.textContent === "string"){
			return elem.textContent
		} else {
			//如果不支持，遍历子节点，如果子节点是元素，并且不支持textContent，那么再遍历，
			//最后都是文本节点
			for(node = elem.firstChild;node; node.nextSibling){
				ret += getText(node)
			}
		}
		//textnode CDATAnode，
	}else if(nodeType === 3 || nodeType === 4){
		return elem.nodeValue
	}
	return ret
}



// function setText(this,value){// Unexpected token this
function setText(value){
	// 分数组和元素两种情况
	// 元素
	if(this.nodeType ===1){
		this.textContent = value
	} else {
		for (var i = 0; i < this.length; i++) {
			this[i].textContent = value
		}
	}
}




$('#test1').click(function() {
	var inner = document.querySelectorAll('.inner')
	alert(html.call(inner))
})

$('#test2').click(function() {
	var inner = document.querySelectorAll('.inner')
	html.call(inner,'慕课网')
})

$('#test3').click(function() {
	var p = document.querySelectorAll("p")[0]
	console.log(text.call(p))
})

$('#test4').click(function() {
	var p = document.querySelectorAll("p")[0]
	// var p = document.querySelectorAll("p")
	text.call(p,'慕课网')
})

</script>

</body>
</html>

